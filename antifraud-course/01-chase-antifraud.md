# 01. Анализ антифрод-системы банка Chase

**Автор:** Вектор Т13
**Длительность:** ~30 минут
**Уровень:** Начальный
**Тип урока:** Практический анализ публичных антифрод-систем

---

## Краткое содержание

Урок посвящён базовому анализу публичных антифрод-систем на примере банка Chase. Рассматривается методология определения используемых антифрод-решений без глубоких знаний программирования, с использованием DevTools браузера и ChatGPT для автоматизации анализа.

---

## Ключевые тезисы

### 1. Типы антифрод-систем

| Тип | Сложность анализа | Время анализа | Особенности |
|-----|-------------------|---------------|-------------|
| **Публичные** | Низкая | ~1 час | Можно зарегистрироваться, открытая документация, не нужен деобфускатор |
| **Самописные** | Высокая | 2 недели + 10-20 часов | Нельзя зарегистрироваться, обфусцированный код, требуется Burp Suite |

### 2. Обнаруженные системы на Chase

- **LexisNexis ThreatMetrix** - основная антифрод-система
- **Akamai** - CDN + проверка репутации IP
- **Dynatrace** - анализ производительности
- **Сканирование портов** - обнаружение TeamViewer и удалённого доступа
- **Canvas-детекция** - определение использования антидетектов

### 3. Критические точки проверки

- WebRTC (STUN/TURN протоколы)
- UDP/TCP соединения
- Латентность и пинги
- Репутация IP-адреса
- Canvas fingerprinting

---

## Полный конспект

### Вступление: два типа антифрод-систем

**Публичные антифрод-системы:**
- Легко определяются (100% случаев)
- Можно зарегистрироваться и изучить изнутри
- Работают на правилах, метриках или сборе сторонних данных
- Не требуется JavaScript-деобфускатор
- Примеры: LexisNexis, Akamai, PerimeterX

**Самописные антифрод-системы:**
- Сложно обнаружить
- Нельзя зарегистрироваться
- Обязательно нужен деобфускатор (99.9% случаев)
- Анализ: ~2 недели машинного времени + 10-20 человеко-часов
- Изучаются через Burp Suite (следующий урок)

### Инструменты анализа

#### 1. Chrome WebRTC Internals
```
chrome://webrtc-internals/
```
- Показывает открытые WebRTC-соединения
- Критически важен для определения работы антифрод-систем
- Позволяет увидеть STUN/TURN подключения

#### 2. Chrome DevTools (F12)
- Вкладка **Network** - анализ сетевых запросов
- Фильтр **Third-party** - только сторонние ресурсы
- **Export HAR** - сохранение всех запросов для анализа

#### 3. ChatGPT для анализа HAR-файлов
- Автоматический анализ за ~8 минут
- Определение используемых антифрод-систем
- Не всегда находит всё (например, Canvas)

### Методология анализа Chase

#### Шаг 1: Подготовка
1. Открыть `chrome://webrtc-internals/`
2. Открыть DevTools (F12) -> Network
3. **Важно:** Удалить cookies перед анализом (антифрод может не включаться для "знакомых" пользователей)

#### Шаг 2: Триггеры антифрод-систем
Антифрод-системы включаются на **критических действиях**:
- Логин
- Регистрация
- Восстановление пароля
- Пополнение/снятие со счёта
- Привязка карты

При простом посещении сайта работает только **антибот** (облегчённая проверка).

#### Шаг 3: Анализ запросов
После выполнения критического действия (например, "Забыли пароль"):
- ~200 запросов
- Экспорт HAR-файла
- Анализ через ChatGPT или вручную

### Обнаруженные технологии на Chase

#### ThreatMetrix (LexisNexis)
- Домен: `aaonlinemetrix.net`
- Использует **TURN протокол** (не STUN!)
- TCP + UDP соединения
- Система **PingPong** - анализ пингов и скорости ответа

**Важно:** Если прокси не поддерживает UDP - 100% детект!

#### Akamai
- 280 000+ серверов по миру
- Проверка **репутации IP-адреса**
- Анализ **латентности** из разных регионов
- Отслеживание активности IP (торренты, обновления Windows, Netflix)

**Как "прогреть" IP:**
1. Поставить IP на роутер/компьютер
2. Использовать для обычной активности (YouTube, игры, обновления)
3. За несколько дней IP станет "чистым"

#### Dynatrace
- Анализ производительности ПК
- Детектирует:
  - VPS/удалённые серверы
  - Виртуальные машины
  - Антидетекты без реальной поддержки WebGPU

#### Canvas-детекция
Технология обнаружения антидетектов:
1. Создаётся поле (например, 50x100 пикселей)
2. Заливается одним цветом
3. Проверяется, были ли изменения в пикселях/альфа-канале
4. Антидетекты вносят "шум" -> детект

**Отличие от Canvas Fingerprinting:**
- Нет текста, эффектов, шрифтов
- Только заливка цветом
- Цель - детект антидетектов, а не идентификация

#### Сканирование портов
Обнаружены проверки портов:
- 5902 (VNC)
- 5939 (TeamViewer)
- 7077 и другие

### Рекомендации по анализу

#### Создание базы HAR-файлов
Для каждого сайта создавать HAR-файлы для:
1. Первое посещение
2. Регистрация
3. Логин
4. Восстановление пароля
5. Привязка карты
6. Пополнение счёта
7. Вывод средств

#### Мониторинг изменений
- Сохранять HAR-файлы
- При проблемах - создать новые
- Сравнивать через **CodeCompare** (DevArt)
- Находить изменения в антифрод-системах

### Требования к инфраструктуре

| Требование | Минимум | Рекомендуется |
|------------|---------|---------------|
| Интернет | 100 Мбит | 1 Гбит |
| Прокси | HTTP | UDP-совместимые |
| 3G модемы | Не рекомендуется | - |

---

## Технические детали

### WebRTC протоколы

| Протокол | Описание | Обход |
|----------|----------|-------|
| **STUN** | Сигнальный сервер, не устанавливает соединение | Легко подменить IP |
| **TURN** | Полноценное соединение TCP+UDP | Нужен UDP-совместимый прокси |

### Домены для блокировки/мониторинга

```
onlinemetrix.net          # ThreatMetrix
aaonlinemetrix.net        # ThreatMetrix WebRTC
*.akamai.net              # Akamai CDN
*.akamaiedge.net          # Akamai Edge
*.dynatrace.com           # Dynatrace
```

### Порты для проверки

```
5902  - VNC
5939  - TeamViewer
7077  - Другие средства удалённого доступа
```

---

## Следующие уроки

- **Burp Suite** - анализ самописных антифрод-систем
- **WebGPU/WebGL** - метрики производительности
- **Счётчики производительности** - детальный анализ

---

## Ключевые выводы

1. **Публичные системы = простой анализ** (1 час vs 2 недели)
2. **Антифрод включается на критических действиях** - не на простом посещении
3. **UDP-прокси обязательны** для сайтов с ThreatMetrix
4. **Репутация IP критична** - прогревайте адреса обычной активностью
5. **Быстрый интернет решает** большинство проблем с латентностью
6. **HAR-файлы = база знаний** о сайте для мониторинга изменений

---

*Транскрибировано: 2026-02-08*
*Источник: Курс Вектор Т13 по антифрод-системам*
