# 02. DNS - идентификатор

**Автор:** Вектор Т13
**Длительность:** ~56 минут
**Уровень:** Средний
**Тип урока:** Глубокий анализ DNS как вектора идентификации

---

## Краткое содержание

DNS равносилен по важности IP-адресу. Неправильная работа с DNS "убивает" прокси изнутри. Урок объясняет, как крупные компании обмениваются данными о бот-трафике через DNS-телеметрию, и как правильно настроить DNS для работы с прокси.

---

## Ключевые тезисы

### 1. Статистика использования DNS в США

| DNS | Доля | Характеристика |
|-----|------|----------------|
| Провайдерский (нативный) | 80% | Обычные пользователи |
| Google (8.8.8.8) | 15.5% | Технически продвинутые |
| Cloudflare (1.1.1.1) | 4.5% | Приватность-ориентированные |

### 2. Организации по обмену данными о ботах

| Организация | Участники | Данные |
|-------------|-----------|--------|
| **M3AAWG** | AT&T, Comcast, Cloudflare, Meta, Microsoft, Google | Блок-листы, телеметрия ботов |
| **FS-ISAC** | Chase, Capital One, JP Morgan, банки | DNS-сигналы о ботах, угрозы |
| **APWG** | Google, Microsoft, Apple, антифрод-системы | Фишинг, ботнеты, API обмена |
| **Cyber Threat Alliance** | Cisco, Palo Alto, Wells Fargo, PayPal, Tesla | VPN/прокси провайдеры, сигнатуры |

### 3. Главный вывод

**Если Google DNS помечает ваш IP как бот-трафик - об этом узнают ВСЕ: Meta, Microsoft, банки, платёжные системы.**

---

## Полный конспект

### Проблема публичных DNS

#### Google DNS (8.8.8.8)
- **Никогда не проводился публичный аудит**
- Только white papers от самой Google
- Заявляют о борьбе с бот-трафиком
- Видят все ваши DNS-запросы с IP прокси

#### Cloudflare DNS (1.1.1.1)
- Публичный аудит был (2022 год)
- Но аудит - это snapshot одного момента
- После аудита всё может измениться
- Активно борются с DDoS = интересуются ботами

### Как вы убиваете свои прокси

#### Типичное поведение пользователя
После покупки "экстра чистого" прокси:
1. Запускает прокси в антидетект-браузере
2. Переходит на BrowserLeaks.com
3. Проверяет Canvas, WebRTC
4. **Нажимает "Run DNS Leak Test"** - RED FLAG
5. Проверяет на MyUnit, ProxyChecker
6. Заходит на сайт прокси-провайдера

**Результат:** Чистый IP мгновенно помечается как подозрительный.

#### Что видит Google DNS

Подозрительные паттерны:
- Посещение BrowserLeaks, IP-чекеров
- Отсутствие запросов к Akamai CDN
- Отсутствие запросов к Microsoft
- Отсутствие нормальной пользовательской активности

#### Что должен видеть легитимный трафик

```
- Windows Update запросы
- Microsoft Office проверки
- Akamai CDN (Netflix, торренты)
- Steam, игры
- Google Chrome sync
- Обычные сайты
```

### Как "прогреть" прокси правильно

1. Установить прокси на **весь роутер/систему** (не только браузер)
2. Оставить машину работать автономно
3. Система сама генерирует легитимный трафик:
   - Обновления Windows
   - Синхронизация приложений
   - Фоновые запросы браузера
4. **Не трогать систему** несколько дней

### Метрики оценки DNS-серверов

| Метрика | Описание |
|---------|----------|
| **DNS Fraud Score** | Репутация IP-адреса DNS-сервера |
| **DNS Subnet Fraud Score** | Репутация всей подсети |
| **DNS ASN Fraud Score** | Репутация автономной системы |
| **Spam Rate** | Доля спам-активности в сети |
| **DNS Anomaly** | Несоответствие UDP/TCP DNS |
| **User IP Activity Bot** | Паттерны бот-активности |

### ASN анализ

**Как отличить хостинг от легитимного провайдера:**

| Параметр | Хостинг | Легитимный ISP |
|----------|---------|----------------|
| IP-адресов | 293,425 | 405,000 |
| Веб-сайтов | 626,851 | 117 |
| Соотношение | Много сайтов на IP | Мало сайтов на IP |

Сервис: [dnslytics.com](https://dnslytics.com)

### Как найти правильный DNS для прокси

#### Инструменты

1. **DetectExpert DNS Checker** (бесплатно)
   - Ввести IP-адрес прокси
   - Получить список 12,500+ DNS-серверов
   - Скопировать в .ini файл

2. **DNS Benchmark** (Steve Gibson, бесплатно)
   - Проверить доступность серверов
   - Измерить скорость ответа
   - Отфильтровать мёртвые

**Важно:** Проверку выполнять только при подключённом прокси!

### DNS Anomaly атака (TCP/UDP)

#### Суть атаки

Веб-ресурс использует рекламный блок с:
1. Сложным доменным именем (уникальным)
2. Сложным DNS-ответом

#### Как работает

1. **UDP запрос** идёт на ваш выставленный DNS (Cloudflare)
2. Сложный запрос **переключается на TCP**
3. TCP-запрос идёт через прокси-сервер
4. Получаются **два разных DNS IP**:
   - UDP: Cloudflare (1.1.1.1)
   - TCP: DNS прокси-провайдера

#### Результат
Два разных IP-адреса DNS = **детект проксификации**

#### Почему антидетекты уязвимы

- Антидетект-браузеры часто не поддерживают UDP
- UDP идёт через системный резольвер
- TCP идёт через браузер
- **Разные IP = 100% детект**

### Рекомендации

#### Правильный подход

1. **Использовать нативный DNS провайдера прокси**
2. **Или поднять прокси на всю систему** (OpenVPN/WireGuard)
3. **Никогда не использовать публичные DNS** с SOCKS-прокси
4. **Не проверять DNS через BrowserLeaks**

#### Для разных регионов

| Регион | Рекомендация |
|--------|--------------|
| США | Критично использовать нативный DNS |
| Европа | Менее критично, но лучше нативный |
| Другие | Важно избегать Google/Cloudflare |

---

## Технические детали

### DNS протоколы

| Протокол | Порт | Использование |
|----------|------|---------------|
| UDP | 53 | Простые запросы (основной) |
| TCP | 53 | Сложные запросы, зона-трансфер |
| DoH | 443 | DNS over HTTPS |
| DoT | 853 | DNS over TLS |

### Как BrowserLeaks определяет DNS

```
1. Генерирует уникальный домен: xyz123.browserleaks.org
2. Ваш DNS запрашивает этот домен
3. DNS BrowserLeaks видит, с какого IP пришёл запрос
4. Это IP вашего DNS-резольвера
```

### GlassWire - анализ трафика

Показывает реальную сетевую активность:
- Какие процессы обращаются в сеть
- По каким доменам
- Видны подключения к Akamai, Microsoft, Google

### Инструменты

| Инструмент | Назначение | Ссылка |
|------------|------------|--------|
| DetectExpert DNS Checker | Поиск DNS по IP прокси | detectexpert.com |
| DNS Benchmark | Проверка DNS-серверов | grc.com |
| GlassWire | Мониторинг сетевого трафика | glasswire.com |
| DNSlytics | Анализ ASN | dnslytics.com |
| CleanTalk | Спам-репутация ASN | cleantalk.org |

---

## Домашнее задание (из урока)

**Вопрос:** Когда вы проверяете DNS-серверы через DNS Benchmark, трафик пойдёт через ваш системный DNS или через Google DNS?

**Ответ:** Если не настроено правильно - через системный DNS, что создаст ещё один Red Flag.

---

## Ключевые выводы

1. **DNS = такой же идентификатор как IP** - нельзя игнорировать
2. **Google/Cloudflare шарят данные** со всеми крупными компаниями
3. **Посещение чекеров убивает прокси** - особенно DNS Leak Test
4. **Прогрев прокси** = запустить на всю систему и не трогать
5. **Нативный DNS провайдера** = лучший выбор для прокси
6. **UDP/TCP аномалия** = современная техника детекта SOCKS
7. **Антидетекты уязвимы** к UDP/TCP атаке

---

## Связанные темы

- ASN и BGP - структура интернета
- CDN сети (Akamai) - как используются для слежки
- SOCKS vs OpenVPN/WireGuard - почему VPN лучше
- Виртуальные роутеры - полносистемная проксификация

---

*Транскрибировано: 2026-02-08*
*Источник: Курс Вектор Т13 по антифрод-системам*
