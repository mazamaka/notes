# 10. M1D и M1D1 - Сетевые отпечатки

**Автор:** Вектор Т13
**Длительность:** ~43 минуты
**Уровень:** Экспертный
**Тип урока:** Сетевые протоколы для идентификации

---

## Краткое содержание

Сетевые отпечатки - самые таинственные и невидимые для пользователя. M1D (TCP+UDP) детектит прокси со 100% вероятностью. M1D1 (TCP+UDP+QUIC) идентифицирует пользователя с 95% точностью. SOCKS5 прокси скоро станут бесполезны. Используется ThreatMetrix, Google, банками.

---

## Ключевые тезисы

### 1. Стеки протоколов

| Стек | Протоколы | Точность | Назначение |
|------|-----------|----------|------------|
| **Zardax** | TCP | ~60% | Определение ОС |
| **M1D** | TCP + UDP | 100% | Детект прокси/VPN |
| **M1D1** | TCP + UDP + QUIC | 95%+ | Идентификация пользователя |

### 2. Что определяется

| Технология | M1D | M1D1 |
|------------|-----|------|
| OpenVPN | Да | Да |
| WireGuard | Да | Да |
| SOCKS5 | Да (100%) | - |
| L2TP/PP2P | Да | Да |
| Пользователь | 60% | 95% |

### 3. Главные угрозы

- **SOCKS5 скоро умрёт** - не поддерживает UDP/QUIC
- **VPN передаёт ваши данные** - заголовки не модифицируются
- **Raspberry Pi переписывает** параметры трафика

---

## Полный конспект

### Почему сетевые отпечатки "таинственные"

| Canvas/WebGL | Сетевые отпечатки |
|--------------|-------------------|
| Видны в исходном коде | Невидимы |
| Детектятся JavaScript | Нет JavaScript |
| Нужен джун | Нужен сетевик |

### Zardax - основа всех TCP-чекеров

**Проект:** github.com/AliPolat/zardax (2023)

Все публичные чекеры (BrowserLeaks и др.) используют базу Zardax.

#### Как работает

1. TCP-соединение инициализирует диалог
2. Клиент сообщает параметры приёма
3. Сервер подстраивается
4. Эти параметры = fingerprint

#### Ключевые параметры

- **TTL** - время жизни пакета
- **MTU/MSS** - максимальный размер пакета
- **Window Size** - размер окна
- **Flags** - флаги TCP

### История: от POF до M1D1

| Год | Технология | Возможности |
|-----|------------|-------------|
| 2004 | POF (NMAP) | Определение ОС по TTL/MTU |
| 2023 | Zardax | TCP fingerprint, база данных |
| 2024 | M1D | TCP + UDP, детект прокси |
| 2025 | M1D1 | + QUIC, идентификация 95% |

### M1D Stack (TCP + UDP)

#### Что определяет

1. Операционная система
2. Использование SOCKS5
3. Использование OpenVPN
4. Использование WireGuard
5. L2TP, PP2P и др.
6. Идентификация бота

#### Эффективность

- Определение ОС: **60%**
- Детект SOCKS5: **100%**
- Детект VPN: **высокая**

### M1D1 Stack (TCP + UDP + QUIC)

**Источник:** Исследование Корнеллского университета США

#### QUIC Protocol

- Разработан Google
- Несколько вариаций
- Основан на UDP
- Используется YouTube, Google Services

#### Эффективность

- Идентификация пользователя: **95%+**
- Не только детект VPN - полная идентификация

### Кто использует

| Компания | Стек | Статус |
|----------|------|--------|
| ThreatMetrix | M1D, M1D1 | Пионер |
| Google | M1D1 | Экосистема |
| PayPal | ThreatMetrix | Официально |
| Банки | M1D | Активно |
| Игровые магазины | M1D | Неожиданно |

### Схема подключения: VPN vs SOCKS5

#### VPN (OpenVPN и др.)

```
User -> VPN -> Website
         |
   Передаёт ВАШИ заголовки
```

**Проблема:** VPN не модифицирует TCP/UDP заголовки. Сайт видит ваши реальные данные.

**Решение:** Можно изменить на своём ПК.

#### SOCKS5

```
User -> SOCKS5 -> Website
            |
    Передаёт СВОИ заголовки
```

**Проблема:** Сайт видит заголовки SOCKS5-сервера, не ваши.

**Критическая проблема:**
- SOCKS5 не поддерживает UDP
- QUIC не работает
- M1D/M1D1 = **100% детект прокси**

### Почему SOCKS5 умрёт

| Протокол | TCP | UDP | QUIC |
|----------|-----|-----|------|
| Поддержка SOCKS5 | Да | Нет* | Нет |
| Требует M1D | Да | Да | - |
| Требует M1D1 | Да | Да | Да |

*Большинство SOCKS5 не поддерживают UDP

**Результат:** Отсутствие UDP/QUIC = поведение нехарактерное для реального пользователя = 100% детект.

### Отключение QUIC

```
chrome://flags -> Experimental QUIC Protocol -> Disabled
```

Убирает M1D1, но M1D остаётся.

### Анализ трафика: Chrome NetExport

#### Как использовать

1. `chrome://net-export/`
2. Include raw bytes: Да
3. Log size: 20 MB
4. Start logging to disk
5. Посетить целевой сайт
6. Stop logging
7. Анализ через netlog-viewer

#### Что можно увидеть

- UDP соединения
- QUIC сессии
- DNS запросы
- WebSocket
- Cross-browser fingerprint
- Использование ThreatMetrix

### Важные параметры Google

| Параметр | Назначение |
|----------|------------|
| **x-browser-validation** | Валидность браузера, когда скачан, с какого IP |
| **x-client-data** | Идентификатор в экосистеме Google |

> "Google всегда знает, что происходит в его ботнете."

### Как изменить сетевые отпечатки

#### TCP Optimizer

- Официальный сайт: speedguide.net
- Изменяет параметры сетевой карты
- Изменяет параметры ОС
- Работает с TCP и UDP

#### Что можно изменить

1. Параметры сетевой карты (Device Manager -> Network Adapter -> Advanced)
2. Параметры ОС (реестр, Traffic Manager, Traffic Inspector)
3. Скрипты для Linux (bash)

### Raspberry Pi - подводный камень

```
User -> Raspberry Pi -> VPN -> Website
             |
    Переписывает ВСЕ параметры
```

**Проблема:** Даже если вы изменили параметры на своём ПК, Raspberry Pi (NAT) переписывает их своими.

**Решение:** Изменить параметры на самой Raspberry Pi (Linux bash скрипт).

### Браузерные антидетекты и M1D

| Возможность | Статус |
|-------------|--------|
| Подмена TCP заголовков | 1 браузер встречал |
| Поддержка UDP | Нет |
| Работа с QUIC | Нет |

**Причина:** Встроенная проксификация Chrome не поддерживает UDP.

---

## Технические детали

### Zardax база данных

Файл: `newclient.json`

```json
{
  "windows": {
    "mss": [1460, 1440, 1280],
    "ttl": [128],
    "window": [65535]
  },
  "linux": {
    "mss": [1460],
    "ttl": [64],
    "window": [29200]
  }
}
```

### Изменение в Windows

```cmd
# Через netsh
netsh interface tcp set global ...

# Через реестр
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters
```

### Linux bash для Raspberry Pi

```bash
#!/bin/bash
# Маскировка под Windows
sysctl -w net.ipv4.ip_default_ttl=128
sysctl -w net.ipv4.tcp_window_scaling=1
# ... и другие параметры
```

### NetExport анализ

Вкладки для проверки:
- **QUIC** - сессии QUIC протокола
- **UDP** - UDP соединения
- **DNS** - DNS запросы (детект DNS leak)
- **Sockets** - все соединения

---

## Инструменты

| Инструмент | Назначение |
|------------|------------|
| chrome://net-export | Логирование трафика |
| netlog-viewer | Анализ логов |
| TCP Optimizer | Изменение параметров |
| Zardax | TCP fingerprint чекер |
| BrowserLeaks TCP/IP | Публичный чекер |

---

## Ключевые выводы

1. **Сетевые отпечатки невидимы** - нельзя найти в исходном коде
2. **M1D = TCP+UDP** - 100% детект SOCKS5
3. **M1D1 = TCP+UDP+QUIC** - 95% идентификация пользователя
4. **SOCKS5 скоро умрёт** - нет UDP = детект
5. **VPN передаёт ваши данные** - заголовки не модифицируются
6. **Raspberry Pi переписывает** - нужно настраивать отдельно
7. **ThreatMetrix = пионер** - PayPal, банки используют
8. **TCP Optimizer** - простой способ изменить отпечатки
9. **Браузерные антидетекты беспомощны** - нет UDP поддержки

---

## Будущее

> "10 лет назад хватало одного плагина Firefox для PayPal. Сейчас это невозможно."

- SOCKS5 перестанет существовать
- Появятся проекты с поддержкой UDP/QUIC
- M1D1 станет стандартом

---

*Транскрибировано: 2026-02-08*
*Источник: Курс Вектор Т13 по антифрод-системам*
