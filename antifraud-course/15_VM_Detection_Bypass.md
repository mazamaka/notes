# Детектирование виртуальных машин: Как работает и как обходят

**Автор:** Vektor T13
**Источник:** YouTube вебинар (Новый год 2026)
**Темы:** Детект VM, Antidetect 5 Exam Edition, TPM чипы

## Исторический контекст

### Эволюция защиты
| Год | Технология | Время до продакшн |
|-----|------------|-------------------|
| 2015 | IP + User-Agent достаточно | — |
| 2015 | WebRTC, WebGL появились | ~3 года |
| 2017 | Audio Fingerprint | 3 года (2018) |
| Chrome 127 | TPM чип | 13 версий (Chrome 140) |

**Вывод:** Технологии не появляются внезапно. Есть время подготовиться.

### Начало Antidetect (2017)
- Первая цель: скрыть виртуальную машину, не браузерные отпечатки
- Предшественник: VirtualBox Hardened (патч с уязвимыми драйверами типа Tsugumi)
- 30% текущих пользователей — с 2018 года

## Выбор гипервизора

### VirtualBox — рекомендуемый
**Плюсы:**
- Открытый исходный код (OSE редакция)
- Полный контроль над изменениями
- Возможность обойти любые детекты

**Минусы:**
- Компилятор KMK — разбираются "полтора человека"
- Архаичные особенности с 2008 года
- Качество кода пострадало в v7 (80-85% работы — фиксы Oracle)

### VMWare
**Плюсы:**
- Стабильнее VirtualBox
- Лучше производительность

**Минусы:**
- Закрытый исходный код
- Патчи только меняют конфиг/реестр
- VMWare Backdoor (порт 5658) — неустраним

### Другие
- Proxmox, HyperV, QEMU — не для Windows
- PCI Passthrough — для проброса видеокарты

## Методы детектирования VM

### Сложность обхода (от простого к сложному)

| Метод | Сложность | Описание |
|-------|-----------|----------|
| CPUID Hypervisor Bit | Низкая | Специальный бит в листьях процессора |
| MAC-адрес | Низкая | Префиксы производителей VM |
| Реестр | Низкая | Ключи VirtualBox/VMWare |
| Процессы | Низкая | VBoxService, vmtoolsd |
| Файловая система | Средняя | Драйверы, Guest Additions |
| WMI запросы | Средняя | Информация об оборудовании |
| Видеокарта | Высокая | Память, шина, caps, буфер кадров |
| Тайминги | Высокая | Ответы северного моста |
| VMWare Backdoor | Экстремальная | Порт 5658, не блокируется firewall |
| Ядро и драйверы | Экстремальная | Невозможно изменить без подписи |

### Важно
- Можно придумать 10 000 детектов
- В продакшн попадут 20-30
- Остальные отбраковываются из-за нестабильности на реальных ПК

## Целевые группы и сложность

| Цель | Сложность | Особенности |
|------|-----------|-------------|
| Антифрод банков | Средняя | 20-30 методов детекта |
| Прокторинг | Средняя | Не работают с ядром |
| **Античиты** | Экстремальная | Работа с ядром ОС, самые продвинутые |

**Античиты — самая сложная категория:**
- Огромное количество пользователей (в 100 раз больше, чем прокторинг)
- Сфокусированы на ядре ОС
- Драйверы уровня ядра

## CPUID и биты гипервизора

- Бит присутствия гипервизора — заложен разработчиками
- В VirtualBox можно изменить через консоль
- Лучший метод — полное пересоздание профилей процессора

## VMWare Backdoor

```
Порт: 5658
Метод: Обращение к порту определяет VM
Защита: Windows Firewall НЕ помогает (уровень ниже)
Решение: Невозможно в VMWare
```

## Видеокарта в VM

**Детектируемые параметры:**
- Объём памяти
- Наличие шины
- Охлаждение
- Кадровый буфер
- Capabilities (возможности)

**WebGPU:** Полная поддержка в Antidetect 5 Exam Edition

### Проброс видеокарты (GPU Passthrough)
- Проект DXVK для игр
- Киберпанк без лагов возможен
- Требует много ручной настройки
- Планируется добавить через 3-6 месяцев

## Antidetect 5 Exam Edition

**Новое в версии:**
- Полная поддержка WebGPU
- Бесплатно, без регистрации и SMS
- Доступен на Detect.Expert

**Версии:**
- Exam Edition — бесплатная
- Core — персональная (сегодня)
- Patreon — завтра

## Вторая часть вебинара: TPM чипы

**Предупреждение:** Возможно, не захотите обновляться

TPM (Trusted Platform Module) — аппаратный модуль безопасности:
- Появился в Chrome 127
- Заработал в Chrome 140
- Цифровой паспорт пользователя
- Новый уровень аутентификации

## Ключевые выводы

1. **Скрыть VM полностью невозможно** — только максимально замаскировать
2. **VirtualBox OSE** — единственный выбор для серьёзной маскировки
3. **Античиты** — самые продвинутые системы детекта
4. **Ядро ОС** — невозможно изменить без подписанных драйверов
5. **TPM чипы** — новая угроза, требует внимания
